version: "3.8"

services:
  # 1. PostgreSQL (관계형 데이터베이스 - 회원정보, 채팅로그)
  postgres:
    image: postgres:15
    container_name: rag_postgres
    environment:
      POSTGRES_USER: rag_user
      POSTGRES_PASSWORD: rag_password
      POSTGRES_DB: rag_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - rag_network

  # 2. Qdrant (벡터 데이터베이스 - 문서 검색용)
  qdrant:
    image: qdrant/qdrant:latest
    container_name: rag_qdrant
    ports:
      - "6333:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    networks:
      - rag_network

  # 3. Redis (캐시 및 대화 기억)
  redis:
    image: redis:alpine
    container_name: rag_redis
    ports:
      - "6379:6379"
    networks:
      - rag_network

  # 4. Neo4j (지식 그래프 - 관계 추론용)
  neo4j:
    image: neo4j:latest
    container_name: rag_neo4j
    ports:
      - "7474:7474" # HTTP 웹 접속용
      - "7687:7687" # Bolt 프로토콜 (백엔드 통신용)
    environment:
      NEO4J_AUTH: neo4j/password
    volumes:
      - neo4j_data:/data
    networks:
      - rag_network

  # 5. Portainer (도커 관리 도구 - GUI) ✅ 추가됨
  portainer:
    image: portainer/portainer-ce:latest
    container_name: rag_portainer
    restart: always
    ports:
      - "9090:9000" # 브라우저 접속 포트
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock # 도커 데몬 제어권
      - portainer_data:/data # 포테이너 설정 저장
    networks:
      - rag_network

networks:
  rag_network:
    driver: bridge

volumes:
  postgres_data:
  qdrant_data:
  neo4j_data:
  portainer_data: # ✅ 추가됨
